# 知识图谱

https://www.jianshu.com/p/e4257ef47c6a

https://blog.csdn.net/guleileo/article/details/80879158

在一项任务中，只要有**关系分析的要求**，知识图谱就“有可能”派上用场

## 什么是知识图谱呢?

知识图谱是由Google公司在2012年提出来的一个新概念

### **学术角度定义**

​		知识图谱本质上是**语义网络**，是一种基于图的数据结构，

​		**图**由节点(Point)和边(Edge)组成。

​		在知识图谱里，每个节点表示现实世界中存在的“实体”，每条边为实体与实体之间的“关系”。

​		知识图谱是关系的最有效的表示方式。知识图谱就是把所有不同种类的信息连接在一起而得到的一个关系网络。知识图谱提供了从“关系”的角度去分析问题的能力。

### **实际应用角度定义**

​		知识图谱≈多关系图(Multi-relational Graph)

​		**多关系图一般包含多种类型的节点和多种类型的边**

<img src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/K6CcD1eo0ibibcxZPdg4KovbDQHYWiakbZknHRT2Qcae4JuUMJiajibZ1Sz7FT2qI1a6CXyrKvUmORg1lMYpMV3xPOQ/640?wx_fmt=png" alt="640?wx_fmt=png" style="zoom:40%; " />

<img src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/K6CcD1eo0ibibcxZPdg4KovbDQHYWiakbZkINCgFKK0BicLsGVGjcllGY0o7EwHToNtibCHrEBdnXE0L4PECW1dQpug/640?wx_fmt=png" alt="640?wx_fmt=png" style="zoom:40%;" />

现实世界中的很多场景非常适合用知识图谱来表达。 比如一个社交网络图谱里，我们既可以有“人”的实体，也可以包含“公司”实体。人和人之间的关系可以是“朋友”，也可以是“同事”关系。人和公司之间的关系可以是“现任职”或者“曾任职”的关系。 类似的，一个风控知识图谱可以包含“电话”、“公司”的实体，电话和电话之间的关系可以是“通话”关系，而且每个公司它也会有固定的电话。 

## 知识图谱的表示

知识图谱应用的前提是已经构建好了知识图谱，也可以把它认为是一个知识库。

在现实世界中，实体和关系也会拥有各自的属性，比如人可以有“姓名”和“年龄”。

当一个知识图谱拥有属性时，我们可以用**属性图（Property Graph）**来表示。属性图的表达很贴近现实生活中的场景，也可以很好地描述业务中所包含的逻辑。

<img src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/K6CcD1eo0ibibcxZPdg4KovbDQHYWiakbZkrWlEWcXjdKpujqe4FeMyv2XS6rXT3NMDJb5OibA7hALUwloys9RGMGA/640?wx_fmt=png" alt="640?wx_fmt=png" style="zoom:50%;" />

上面的图表示一个简单的属性图。李明和李飞是父子关系，并且李明拥有一个138开头的电话号，这个电话号开通时间是2018年，其中2018年就可以作为关系的属性。类似的，李明本人也带有一些属性值比如年龄为25岁、职位是总经理等。 	

知识图谱也可以用**RDF**来表示，它是由很多的三元组（Triples）来组成。RDF在设计上的主要特点是易于发布和分享数据，但不支持实体或关系拥有属性，如果非要加上属性，则在设计上需要做一些修改。

目前来看，RDF主要还是用于学术的场景，在工业界我们更多的还是采用图数据库（比如用来存储属性图）的方式。

### 知识图谱特点

1. 能够以一种统一的形式（三元组格式）表示**实例型数据和描述型数据**

## 知识体系构建

知识图谱不仅包含具体的实例知识数据，还包括了**对知识数据的描述和定义**，这部分对数据进行描述和定义的“元”数据被称为**知识体系(Schema)或本体(Ontology)**,知识体系具有很高的抽象性和概括性

知识体系主要包括三个方面的核心内容: 对概念的分类、概念属性的描述、概念之间相互关系

**知识体系基本形态**包括词汇(Terms)、概念(Concepts)、分类关系(Taxonomic Relations)、非分类关系(Non-Taxonomic Relations)和公理(Axioms)这五个层次

## 知识抽取

知识图谱的构建是后续应用的基础，而且构建的前提是需要把数据从不同的数据源中抽取出来。

对于垂直领域的知识图谱来说，它们的数据源主要来自两种渠道：

一种是业务本身的数据，这部分数据通常包含在公司内的数据库表并以**结构化**的方式存储，只需要简单预处理即可以作为后续AI系统的输入；

另一种是网络上公开、抓取的数据，这些数据通常是以网页的形式存在所以是**非结构化的数据**，一般需要借助于自然语言处理等技术来提取出结构化信息。信息抽取的难点在于处理非结构化数据。

在构建图谱过程中，主要涉及以下几个方面的自然语言处理技术：

### a. 实体命名识别（Name Entity Recognition）   

<img src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/K6CcD1eo0ibibcxZPdg4KovbDQHYWiakbZkoj29iarkKL28v0T0v0nncmXhl85GJKRfzqqyULZkFMBCsM51dgLibzCg/640?wx_fmt=png" alt="640?wx_fmt=png" style="zoom:60%;" />

​		实体命名识别，就是从文本里提取出实体并对每个实体做分类/打标签：

​		比如从上述文本里，我们可以提取出实体-“NYC”，并标记实体类型为 “Location”；我们也可以从中提取出“Virgil's BBQ”，并标记实体类型为“Restaurant”。这种过程称之为**实体命名识别**，这是一项相对比较成熟的技术，有一些现成的工具可以用来做这件事情。



### b. 关系抽取（Relation Extraction）   

​		我们可以通过关系抽取技术，把实体间的关系从文本中提取出来，比如实体“hotel”和“Hilton property”之间的关系为“in”；“hotel”和“Time Square”的关系为“near”等等。

<img src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/K6CcD1eo0ibibcxZPdg4KovbDQHYWiakbZkcCnk3mHOKjpia8IRoBCU9IjReTPXNFfkEIg4jHovhgrkEsrUtboySyg/640?wx_fmt=png" alt="640?wx_fmt=png" style="zoom:60%;" />

### c. 实体统一（Entity Resolution） 

​		有些实体写法上不一样，但其实是指向同一个实体。比如“NYC”和“New York”表面上是不同的字符串，但其实指的都是纽约这个城市，需要合并。

​		实体统一不仅可以减少实体的种类，也可以降低图谱的稀疏性（Sparsity）；

<img src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/K6CcD1eo0ibibcxZPdg4KovbDQHYWiakbZk2EoVJQDJC1Ta9kGHnLkMQsOJzabTQ7cShwQN4l2P09K7JeIC9ibWY1g/640?wx_fmt=png" alt="640?wx_fmt=png" style="zoom:60%;" />

### d. 指代消解（Coreference Resolution）

​		指代消解，也是文本中出现的“it”, “he”, “she”这些词到底指向哪个实体，比如在本文里两个被标记出来的“it”都指向“hotel”这个实体。实体统一和指代消解问题相对于前两个问题更具有挑战性。

## 知识图谱的存储

知识图谱主要有两种存储方式：一种是基于RDF的存储；另一种是基于图数据库的存储。

### RDF特点

+ 存储三元组
+ 标准的推理引擎
+ W3C标准
+ 易于发布数据
+ 多数为学术界场景

### 图数据库特点

+ 节点和关系可以带有属性
+ 没有标准的推理引擎
+ 图的遍历效率高
+ 事务管理
+ 基本为工业界场景

RDF一个重要的设计原则是**数据的易发布以及共享**，图数据库则把重点放在了**高效的图查询和搜索上**。

其次，RDF以三元组的方式来存储数据而且不包含属性信息，但图数据库一般以属性图为基本的表示形式，所以实体和关系可以包含属性，这就意味着更容易表达现实的业务场景。

其中Neo4j系统目前仍是使用率最高的图数据库，它拥有活跃的社区，而且系统本身的查询效率高，但唯一的不足就是不支持准分布式。相反，Orient DB 和 Janus Graph（原Titan）支持分布式，但这些系统相对较新，社区不如Neo4j活跃，这也就意味着使用过程当中不可避免地会遇到一些刺手的问题。如果选择使用RDF的存储系统，Jena或许一个比较不错的选择。

## 知识图谱的搭建

**搭建一个知识图谱系统，其实最重要的核心在于对业务的理解以及对知识图谱本身的设计**

一个完整的知识图谱的构建包含以下几个步骤

### 定义具体的业务问题

​		首先要明确一点，**对于自身的业务问题到底需不需要知识图谱系统的支持**。因为在很多的实际场景，即使对关系的分析有一定的需求，实际上也可以利用传统数据库来完成分析的。所以要避免为了使用知识图谱而选择知识图谱。

#### 如何选择

1. 如果需要设计的知识图谱非常简单，而且查询也不会涉及到1度以上的关联查询，我们可以选择用关系型数据存储格式来保存知识图谱。

2. 对那些稍微复杂的关系网络（现实生活中的实体和关系普遍都比较复杂），知识图谱的优点还是非常明显的。

   首先，在关联查询的效率上会比传统的存储方式有显著的提高。当我们涉及到2,3度的关联查询，基于知识图谱的查询效率会高出几千倍甚至几百万倍。

   其次，基于图的存储在设计上会非常灵活，一般只需要局部的改动即可。比如我们有一个新的数据源，我们只需要在已有的图谱上插入就可以。于此相反，关系型存储方式灵活性方面比较差，它所有的Schema都是提前定义好的，如果后续要改变，它的代价是非常高的。

   最后，**把实体和关系存储在图数据结构是一种符合整个故事逻辑的最好的方式**。

3. 如果对可视化需求不高，很少涉及到关系的深度搜索，关系查询效率要求不高，数据缺乏多样性，暂时没有人力或成本不够，可以用更简单的方式。

   如果有强烈的可视化需求，经常涉及到关系的深度搜索，对关系查询效率有实时性要求，数据多样化，解决数据孤岛问题，有能力、有成本搭建系统，选择知识图谱。

### 数据的收集 & 预处理

要确定数据源以及做必要的数据预处理。

针对于数据源，我们需要考虑以下几点：

1. 我们已经有哪些数据？

2. 虽然现在没有，但有可能拿到哪些数据？

3. 其中哪部分数据可以用来降低风险？

4. 哪部分数据可以用来构建知识图谱？

   在这里需要说明的一点是，并不是所有相关的数据都必须要进入知识图谱，对于这部分的一些决策原则在接下来的部分会有比较详细的介绍。

#### 示例

对于互联网金融反欺诈项目，有几个数据源是我们很容易想得到的，包括用户的基本信息、行为数据、运营商数据、网络上的公开信息等等。假设我们已经有了一个数据源的列表清单，则下一步就要看哪些数据需要进一步的处理，比如对于**非结构化数据**我们或多或少都需要用到跟自然语言处理相关的技术。 用户填写的基本信息基本上会存储在业务表里，除了个别字段需要进一步处理，很多字段则直接可以用于建模或者添加到知识图谱系统里。对于**行为数据**来说，我们则需要通过一些简单的处理，并从中提取有效的信息比如“用户在某个页面停留时长”等等。 对于**网络上公开的网页数据**，则需要一些信息抽取相关的技术。

举个例子，对于用户的基本信息，我们很可能需要如下的操作。一方面，用户信息比如姓名、年龄、学历等字段可以直接从结构化数据库中提取并使用。但另一方面，对于填写的公司名来说，我们有可能需要做进一步的处理。比如部分用户填写“北京贪心科技有限公司”，另外一部分用户填写“北京望京贪心科技有限公司”，其实指向的都是同一家公司。所以，这时候我们需要做公司名的对齐，用到的技术细节可以参考前面讲到的实体对齐技术。

### 知识图谱的设计

​		图谱的设计是一门艺术，不仅要对业务有很深的理解、也需要对未来业务可能的变化有一定预估，从而设计出最贴近现状并且性能高效的系统。在知识图谱设计的问题上，我们肯定会面临以下几个常见的问题：

1. 需要哪些实体、关系和属性？
2. 哪些属性可以做为实体，哪些实体可以作为属性？
3. 哪些信息不需要放在知识图谱中？

![img](https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/K6CcD1eo0ibibcxZPdg4KovbDQHYWiakbZku4VwtYPntffvdacgoxgZX9fb3JO0reOBeRicOZwphiaKYzJf3f8sWbog/640?wx_fmt=png)

#### 设计原则

+ 业务原则(Business Principle)

  **一切要从业务逻辑出发，并且通过观察知识图谱的设计也很容易推测其背后业务的逻辑，而且设计时也要想好未来业务可能的变化。**一个好的设计很容易让人看到业务本身的逻辑

  

+ 分析原则(Analytics Principle)

  我们不需要把跟关系分析无关的实体放在图谱当中

+ 效率原则(Efficiency Principle)

  **效率原则让知识图谱尽量轻量化、并决定哪些数据放在知识图谱，哪些数据不需要放在知识图谱**``

  我们把常用的信息存放在知识图谱中，把那些访问频率不高，对关系分析无关紧要的信息放在传统的关系型数据库当中。 

  **效率原则的核心在于把知识图谱设计成小而轻的存储载体。**

+ 冗余原则(Redundancy Principle)

  有些重复性信息、高频信息可以放到传统数据库当中

### 把数据存入知识图谱

​		存储上我们要面临存储系统的选择，但由于我们设计的知识图谱带有属性，图数据库可以作为首选。但至于选择哪个图数据库也要看业务量以及对效率的要求。如果数据量特别庞大，则Neo4j很可能满足不了业务的需求，这时候不得不去选择支持准分布式的系统比如Orient DB, Janus Graph等，或者通过效率、冗余原则把信息存放在传统数据库中，从而减少知识图谱所承载的信息量。 通常来讲，对于10亿节点以下规模的图谱来说Neo4j已经足够了。

### 上层应用的开发，以及系统的评估

​		我们构建好知识图谱之后，接下来就要使用它来解决具体的问题。对于风控知识图谱来说，首要任务就是挖掘关系网络中隐藏的欺诈风险。**从算法的角度来讲，有两种不同的场景：一种是基于规则的；另一种是基于概率的**。鉴于目前AI技术的现状，基于规则的方法论还是在垂直领域的应用中占据主导地位，但随着数据量的增加以及方法论的提升，基于概率的模型也将会逐步带来更大的价值。

#### 基于规则的方法论

+ 不一致验证

  为了判断关系网络中存在的风险，一种简单的方法就是做不一致性验证，也就是通过一些规则去找出潜在的矛盾点。这些规则是以人为的方式提前定义好的，所以在设计规则这个事情上需要一些业务的知识。

  比如在下面的这个图中，李明和李飞两个人都注明了同样的公司电话，但实际上从数据库中判断这俩人其实在不同的公司上班，这就是一个矛盾点。

  <img src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/K6CcD1eo0ibibcxZPdg4KovbDQHYWiakbZkHGIYcRiaGuic1KRHkGPVod2Zicht2VOeNpKodJBrKybYRjNPPoliaIKbnA/640?wx_fmt=png" alt="img" style="zoom:50%;" />

  

+ 基于规则提取验证

  我们也可以基于规则从知识图谱中提取一些特征，而且这些特征一般基于深度的搜索比如2度，3度甚至更高维度。

  比如我们可以问一个这样的问题：“申请人二度关系里有多少个实体触碰了黑名单？”，从图中我们观察到二度关系中有两个实体触碰了黑名单（黑名单由红色来标记）。等这些特征被提取之后，一般可以作为风险模型的输入。在此还是想说明一点，如果特征并不涉及深度的关系，其实传统的关系型数据库则足以满足需求。

  <img src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/K6CcD1eo0ibibcxZPdg4KovbDQHYWiakbZkibpknDyvRsrXytBh5zE9603NXK8pXpHKdnykYVLaVEVianTxh9sica7ibQ/640?wx_fmt=png" alt="img" style="zoom:50%;" />

+ 基于模式的判断

  这种方法比较适用于找出团体欺诈，它的核心在于通过一些模式来找到有可能存在风险的团体或者子图（sub-graph），然后对这部分子图做进一步的分析。

  这种模式有很多种，在这里举几个简单的例子。 比如在下图中，三个实体共享了很多其他的信息，我们可以看做是一个团体，并对其做进一步的分析。

  <img src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/K6CcD1eo0ibibcxZPdg4KovbDQHYWiakbZkmvJqZQCibK0eamQhgibbgb9cI41aCv03wdqwVG4OVibz7XS4Edb2CFibKg/640?wx_fmt=png" alt="img" style="zoom:50%;" />

  

  <img src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/K6CcD1eo0ibibcxZPdg4KovbDQHYWiakbZk1hwmCWia9jL17GDxDUHzzNq29s910BFj0ulpVNnOCEQNc43AkqRDTEA/640?wx_fmt=png" alt="img" style="zoom:50%;" />

  我们也可以从知识图谱中找出强连通图，并把它标记出来，然后做进一步风险分析。强连通图意味着每一个节点都可以通过某种路径达到其他的点，也就说明这些节点之间有很强的关系。

  

  

  
  
  
#### 基于概率的方法

相比规则的方法论，基于概率的方法的缺点在于：需要足够多的数据。如果数据量很少，而且整个图谱比较稀疏（Sparse），基于规则的方法可以成为我们的首选。尤其是对于金融领域来说，数据标签会比较少，这也是为什么基于规则的方法论还是更普遍地应用在金融领域中的主要原因。

社区挖掘、标签传播、聚类等技术都属于这个范畴

​		社区挖掘算法的目的在于从图中找出一些社区。对于社区，我们可以有多种定义，但直观上可以理解为社区内节点之间关系的密度要明显大于社区之间的关系密度。下面的图表示社区发现之后的结果，图中总共标记了三个不同的社区。一旦我们得到这些社区之后，就可以做进一步的风险分析。由于社区挖掘是基于概率的方法论，好处在于不需要人为地去定义规则，特别是对于一个庞大的关系网络来说，定义规则这事情本身是一件很复杂的事情。

<img src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/K6CcD1eo0ibibcxZPdg4KovbDQHYWiakbZk7TE2K0fHjscfsaVRT8JMjcJcXnABoUvOibibKkEcIqPsSRvZKD6VcpBQ/640?wx_fmt=png" alt="img" style="zoom:50%;" />

​		标签传播算法的核心思想在于节点之间信息的传递。这就类似于，跟优秀的人在一起自己也会逐渐地变优秀是一个道理。因为通过这种关系会不断地吸取高质量的信息，最后使得自己也会不知不觉中变得更加优秀。具体细节不在这里做更多解释。

#### 基于动态网络的分析**

​		以上所有的分析都是基于静态的关系图谱。所谓的静态关系图谱，意味着我们不考虑图谱结构本身随时间的变化，只是聚焦在当前知识图谱结构上。然而，我们也知道图谱的结构是随时间变化的，而且这些变化本身也可以跟风险有所关联。

在下面的图中，我们给出了一个知识图谱T时刻和T+1时刻的结构，我们很容易看出在这两个时刻中间，图谱结构（或者部分结构）发生了很明显的变化，这其实暗示着潜在的风险。那怎么去判断这些结构上的变化呢？ 感兴趣的读者可以查阅跟“dynamic network mining”相关的文献。

<img src="https://ss.csdn.net/p?https://mmbiz.qpic.cn/mmbiz_png/K6CcD1eo0ibibcxZPdg4KovbDQHYWiakbZkOlTvwqLvrYOzKIrjXLIs714x0nCicx3qsc8LHApxlfhwGEAMhgzmdzA/640?wx_fmt=png" alt="img" style="zoom:50%;" />

## 实践建议

​		首先，知识图谱是一个比较新的工具，它的主要作用还是在于分析关系，尤其是深度的关系。所以在业务上，首先要确保它的必要性，其实很多问题可以用非知识图谱的方式来解决。

​		知识图谱领域一个最重要的话题是知识的推理。 而且知识的推理是走向强人工智能的必经之路。但很遗憾的，目前很多语义网络的角度讨论的推理技术（比如基于深度学习，概率统计）很难在实际的垂直应用中落地。其实目前最有效的方式还是基于一些规则的方法论，除非我们有非常庞大的数据集。

​		最后，还是要强调一点，**知识图谱工程本身还是业务为重心，以数据为中心。不要低估业务和数据的重要性。**

不同知识图谱关注领域和侧面不同，如何对它们进行综合利用是一个重要问题。

